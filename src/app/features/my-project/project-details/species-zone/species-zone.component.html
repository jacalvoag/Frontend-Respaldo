<div class="species-container">

    <div class="species-header">
        <h2 class="species-title">Especies registradas - {{ currentZone()?.zoneName }}</h2>
        <button class="button-light" (click)="openAddSpeciesModal()">
        <svg class="svg-button" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24">
            <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        </svg>
        AÃ±adir especie
        </button>
    </div>

    <div class="divider"></div>

    @if (loading()) {
        <div class="loading-state">
        <h4>Cargando las especies...</h4>
        </div>
    } @else {

        <div class="species-grid">
        @for (species of recordedSpecies(); track species.speciesId) {
            <div class="species-card" [class.species-card--no-image]="!species.speciesPhoto">

            <h3 class="species-name">{{ species.speciesName }}</h3>

            <div class="species-card-main">
                @if (species.speciesPhoto) {
                    <img [src]="species.speciesPhoto" [alt]="species.speciesName" class="species-image">
                }

                <div class="species-info">
                    <p><strong>Unidad de muestreo:</strong> {{ species.samplingUnit || 'No especificado' }}</p>
                    <p><strong>Tipo funcional:</strong> {{ species.functionalType || 'No especificado' }}</p>
                    <p><strong>Numero de individuos:</strong> {{ species.numberOfIndividuals || '0' }}</p>
                    <p><strong>Altura o estrato:</strong> {{ species.heightOrStratum || 'No especificado' }}</p>
                </div>
            </div>

            <div class="species-footer">
                <span >
                </span>

                <button 
                class="options-button"
                (click)="toggleMenu(species.speciesId)"
                [attr.aria-expanded]="openMenuId === species.speciesId">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                    <path d="M480-160q-33 0-56.5-23.5T400-240q0-33 23.5-56.5T480-320q33 0 56.5 23.5T560-240q0 33-23.5 56.5T480-160Zm0-240q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm0-240q-33 0-56.5-23.5T400-720q0-33 23.5-56.5T480-800q33 0 56.5 23.5T560-720q0 33-23.5 56.5T480-640Z"/>
                </svg>
                </button>

                <div 
                class="options-dropdown"
                [class.options-dropdown--open]="openMenuId === species.speciesId">
                <button 
                    class="dropdown-item"
                    (click)="editSpecies(species)">
                    <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="currentColor">
                    <path d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"/>
                    </svg>
                    Editar
                </button>
                <button 
                    class="dropdown-item dropdown-item--danger"
                    (click)="deleteSpecies(species.speciesId)">
                    <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="currentColor">
                    <path d="m376-300 104-104 104 104 56-56-104-104 104-104-56-56-104 104-104-104-56 56 104 104-104 104 56 56Zm-96 180q-33 0-56.5-23.5T200-200v-520h-40v-80h160v-40h240v40h160v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520Z"/>
                    </svg>
                    Eliminar
                </button>
                </div>
            </div>
            </div>
        } @empty {
            <div class="empty-state">
            <p>No hay especies registradas en esta zona de estudio todavia.</p>
            </div>
        }
        </div>

    }
</div>

@if (showAddSpeciesModal) {
  <app-newspecie-form
    [show]="showAddSpeciesModal"
    [zoneId]="zoneId"
    (close)="closeAddSpeciesModal()"
    (save)="onSpeciesCreated($event)">
  </app-newspecie-form>
}

@if (showEditSpeciesModal) {
  <app-newspecie-form
    [show]="showEditSpeciesModal"
    [zoneId]="zoneId"
    [speciesData]="selectedSpecies"
    (close)="closeEditSpeciesModal()"
    (speciesUpdated)="onSpeciesUpdated($event)">
  </app-newspecie-form>
}